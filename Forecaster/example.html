<!DOCTYPE html>
<html>

<head>
    <title>Create Dynamic Column Chart using PHP Ajax with Google Charts</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
</head>

<body>
    <br /><br />
    <div class="container">
        <h3 align="center">Create Dynamic Column Chart using PHP Ajax with Google Charts</h3>
        <br />

        <div class="panel panel-default">
            <div class="panel-heading">
                <div class="row">
                    <div class="col-md-9">
                        <h3 class="panel-title">Month Wise Profit Data</h3>
                    </div>
                    <div class="col-md-3">
                        <input type="number" id="year" value="1996" onchange="getValue()">
                    </div>
                </div>
            </div>
            <div class="panel-body">
                <div id="chart_area" style="width: 1000px; height: 620px;"></div>
            </div>
        </div>
    </div>
</body>

</html>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    var yearInputField = document.getElementById('year');

    google.charts.load('current', { packages: ['corechart', 'bar'] });
    google.charts.setOnLoadCallback();

    async function fetchData() {
        var index = 1;
        const url = `assets/js/data.json`;
        const response = await fetch(url);
        const data = await response.json();
        // console.log(data.fuelCostData[index])
        return data;
    }

    function getValue() {

        fetchData().then(data => {
            var index = 0;
            if (yearInputField.value == 1996) {
                index = 0;
            }
            else if (yearInputField.value == 1997) {
                index = 1;
            }

            const years = data.fuelCostData.map(
                function (index) {
                    return index.year;
                }
            );
            const months = data.fuelCostData[index].record.map(
                function (index) {
                    return index.month;
                }
            );
            const D7DW = data.fuelCostData[index].record.map(
                function (index) {
                    return index.D7DW;
                }
            );
            const D7DU = data.fuelCostData[index].record.map(
                function (index) {
                    return index.D7DU;
                }
            );
            const D7DT = data.fuelCostData[index].record.map(
                function (index) {
                    return index.D7DT;
                }
            );
            const D7DV = data.fuelCostData[index].record.map(
                function (index) {
                    return index.D7DV;
                }
            );
            // console.log(years, months, D7DW, D7DU, D7DT, D7DV)
            drawMonthwiseChart(years, months, D7DW, D7DU, D7DT, D7DV)
        });

    }

    function drawMonthwiseChart(years, months, D7DW, D7DU, D7DT, D7DV) {
        var data = new google.visualization.DataTable();
        if (yearInputField.value < 1996 || yearInputField.value > 1997) {
            data.addColumn({ label: 'Month', type: 'string' });
            data.addColumn({ label: 'Cost', type: 'number' });
            data.addColumn({ role: 'annotation', type: 'string' });
            // data.addColumn('string', 'msg');
            data.addRows([
                ['', 0, 'No Data Available']
            ]);
        } else {
            data.addColumn('string', 'Month');
            data.addColumn('number', 'D7DW');
            data.addColumn('number', 'D7DU');
            data.addColumn('number', 'D7DT');
            data.addColumn('number', 'D7DV');
            var month;
            var d7dw;
            var d7du;
            var d7dt;
            var d7dv;

            months.forEach((i) => {
                month = i;
                D7DW.forEach((i) => {
                    d7dw = parseFloat(i);
                });
                D7DU.forEach((i) => {
                    d7du = parseFloat(i);
                });
                D7DT.forEach((i) => {
                    d7dt = parseFloat(i);
                });
                D7DV.forEach((i) => {
                    d7dv = parseFloat(i);
                });
                data.addRows([[month, d7dw, d7du, d7dt, d7dv]]);
                // console.log([[month, d7dw, d7du]]);
            });
        }
        
        var options = {
            title: 'Fuel Cost History',
            annotations: {
                stem: {
                    color: 'transparent',
                    length: 180
                },
                textStyle: {
                    color: 'red',
                    fontSize: 32
                }
            },
            vAxis: {
                title: 'Cost',
                minValue: 0,
                maxValue: 70,
                format: 'decimal'
            },
            hAxis: {
                title: 'Month'
            },
            height: 600,
            colors: ['#41DA96', '#71EB92', '#E6AC2B', '#FAAFF9']
        };


        var chart = new google.visualization.ColumnChart(document.getElementById('chart_area'));
        chart.draw(data, options);
    }

    getValue()
</script>